name: Code Quality & Auto-fix
'on':
  push:
    branches:
    - main
  pull_request:
    branches:
    - main
  schedule:
  - cron: 0 2 * * *
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true
jobs:
  quality-check:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        fetch-depth: 0
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: npm
    - name: Install dependencies
      run: npm ci || npm install
    - name: Create ESLint config if missing
      run: "\n                            if [ ! -f .eslintrc.js ] && [ ! -f .eslintrc.json\
        \ ] && [ ! -f eslint.config.js ]; then\n                              echo\
        \ \"Creating basic ESLint config...\"\n                              cat >\
        \ .eslintrc.json << EOF\n                            {\n                 \
        \             \"env\": {\n                                \"node\": true,\n\
        \                                \"es2021\": true\n                      \
        \        },\n                              \"extends\": [\"eslint:recommended\"\
        ],\n                              \"parserOptions\": {\n                 \
        \               \"ecmaVersion\": 12,\n                                \"sourceType\"\
        : \"module\"\n                              },\n                         \
        \     \"rules\": {}\n                            }\n                     \
        \       EOF\n                            fi\n                        "
    - name: Run ESLint with auto-fix
      run: "\n                            # Install ESLint if not present\n      \
        \                      if ! npm list eslint > /dev/null 2>&1; then\n     \
        \                         npm install --no-save eslint\n                 \
        \           fi\n                            \n                           \
        \ # Run ESLint on JavaScript/TypeScript files\n                          \
        \  npx eslint . --fix --ext .js,.jsx,.ts,.tsx --ignore-pattern node_modules/\
        \ --ignore-pattern dist/ || echo \"ESLint completed with warnings\"\n    \
        \                    "
    - name: Run Prettier if available
      run: "\n                            if npm list prettier > /dev/null 2>&1; then\n\
        \                              npx prettier --write \"**/*.{js,jsx,ts,tsx,json,css,md}\"\
        \ --ignore-path .gitignore || echo \"Prettier completed\"\n              \
        \              else\n                              echo \"Prettier not installed,\
        \ skipping formatting\"\n                            fi\n                \
        \        "
    - name: Check for changes
      id: verify-changed-files
      run: "\n                            if [ -n \"$(git status --porcelain)\" ];\
        \ then\n                              echo \"changed=true\" >> $GITHUB_OUTPUT\n\
        \                              echo \"Changes detected:\"\n              \
        \                git status --porcelain\n                            else\n\
        \                              echo \"changed=false\" >> $GITHUB_OUTPUT\n\
        \                              echo \"No changes detected\"\n            \
        \                fi\n                        "
    - name: Commit auto-fixes
      if: steps.verify-changed-files.outputs.changed == 'true' && github.event_name
        != 'pull_request'
      run: "\n                            git config --local user.email \"action@github.com\"\
        \n                            git config --local user.name \"GitHub Action\"\
        \n                            git add -A\n                            git\
        \ commit -m \"\U0001F527 Auto-fix code quality issues [skip ci]\"\n      \
        \                      git push\n                        "
